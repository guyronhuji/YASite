---
import Layout from '../../../layouts/Layout.astro';
import Navbar from '../../../components/Navbar.astro';
import { getCollection } from 'astro:content';

export async function getStaticPaths() {
  const collections = ['research', 'activism', 'outreach', 'services', 'publications'];
  const langs = ['en', 'he', 'ar'];
  
  const paths = [];
  for (const collectionName of collections) {
      const items = await getCollection(collectionName as any);
      for (const item of items) {
          const parts = item.slug.split('/');
          if (parts.length < 2) continue;
          const lang = parts[0];
          const slug = parts.slice(1).join('/');
          
          if (langs.includes(lang)) {
              paths.push({ 
                  params: { lang, collection: collectionName, slug },
                  props: { item }
              });
          }
      }
  }
  return paths;
}

const { lang, collection } = Astro.params;
const { item } = Astro.props;
const { Content } = await item.render();

const backLabels = {
    en: 'Back to list',
    he: 'חזרה לרשימה',
    ar: 'العودة للقائمة'
};
---

<Layout title={item.data.title} lang={lang} backgroundImage={item.data.backgroundImage}>
  <main class="py-12 px-4 sm:px-6 lg:px-8">
    <a href={`/${lang}/${collection}`} class="text-accent hover:text-primary mb-8 inline-block font-medium rtl:flip">
         &larr; {backLabels[lang]}
    </a>
    
    <article class="prose prose-lg prose-indigo mx-auto text-gray-800 max-w-none leading-[1.75]">
      <h1 class="text-[#000040] font-extrabold font-serif">{item.data.title}</h1>
      

            <div class="metadata text-sm text-gray-500 mb-8 pb-4 border-b border-gray-100 flex flex-wrap gap-4">
          {item.data.venue && <span>{item.data.venue}</span>}
         {item.data.authors && <span>{item.data.authors.join(', ')}</span>}
         {item.data.url && <a href={item.data.url} target="_blank" class="text-indigo-600 underline">Link to Resource</a>}
      </div>

      <Content />
    </article>
  </main>
</Layout>

<style>
/* Simple utility to flip arrow in RTL */
:global([dir="rtl"]) .rtl\:flip {
    transform: scaleX(-1);
    display: inline-block;
}
</style>
